
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Automating Underlying Mobile Infrastructure With Grunt - Josh Bavari's Ramblings</title>
  <meta name="author" content="Josh Bavari">

  
  <meta name="description" content="I&rsquo;m obsessed with automating some of the tasks that I find myself repetitively doing. I don&rsquo;t know about you, but I hate doing the same &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jbavari.github.io/blog/2013/12/02/automating-underlying-mobile-infrastructure-with-grunt">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Josh Bavari's Ramblings" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Josh Bavari's Ramblings</a></h1>
  
    <h2>tech babbles on Ruby, Javascript, Rails, Phonegap/Cordova, Grunt, and more</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jbavari.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/speaking">Speaking</a></li>
  <li><a href="/knowledge">Knowledge</a></li>
  <li><a href="/about/resume">Resume</a></li>
  <li><a href="/about/cv">C.V.</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Automating Underlying Mobile Infrastructure With Grunt</h1>
    
    
      <p class="meta">
        <span class="reading-time">about a 4 minute read</span>
        








  


<time datetime="2013-12-02T19:15:00-07:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;m obsessed with automating some of the tasks that I find myself repetitively doing. I don&rsquo;t know about you, but I hate doing the same thing over and over &ndash; it&rsquo;s boring and pointless</p>

<p>I posted a little while ago regarding automation of phonegap build and deployments, see that <a href="/blog/2013/11/30/automating-phonegap-builds-with-grunt/">here</a>.</p>

<h2>Why am I bothering with this?</h2>

<p>Our mobile app is the core of what we do. As you may already well know, most mobile apps require an API server serving the application data. In this post, I&rsquo;d like to address automating the underlying infrastructure that supports the mobile app.</p>

<h3>It&rsquo;s a two-fold win</h3>

<p>The main reason is to help get the server stack up without doing all of the repetitive tasks. Getting the mobile infrastructure up can be a slight annoyance, especially when your task is to code.</p>

<p>We have a designer that works on the mobile app styles, and he shouldn&rsquo;t need to know or care about the requirements of the app just to get to work.</p>

<p>The second reason that I&rsquo;d want to automate the server stack is due to my frequently using <a href="http://people.apache.org/~pmuellr/weinre/docs/latest/">Weinre</a>. I use it a lot to debug either the iOS app or the Android app. Another thing to automate would be to get the weinre server up and have the script for it injected into my source references without having to manually do it.</p>

<h3>What I&rsquo;d prefer we do..</h3>

<p>I&rsquo;d like to just type simple commands&hellip; Something I can type to get my local dev servers up, or our designer can type that will get the whole stack and emulator running.</p>

<p>For our designer, I&rsquo;d want &lsquo;grunt emulate&rsquo;. For myself, I&rsquo;d want &lsquo;grunt emulate &mdash;weinre=true &mdash;host=192.168.1.100&rsquo; &ndash; either of those commands would do the following:</p>

<ul>
<li>Boot up Rails server at a specified IP</li>
<li>Boot up the weinre server at a specified IP (optionally)</li>
<li>Preprocess the index.html file to have the weinre javascript source reference</li>
<li>Adjust the app settings to be at the specified IP</li>
<li>Execute the xcode build command for the iOS project</li>
<li>Open the built app on the iOS Simulator</li>
</ul>


<h3>How to get there</h3>

<p>To get some of the servers up and running, we need a grunt task that would invoke those processes and would continue running in the background while the other tasks continue running. For this, we&rsquo;ll need another Grunt plugin, called <a href="https://npmjs.org/package/grunt-bg-shell">Grunt bgShell</a></p>

<p>First we&rsquo;ll define the background shell tasks in our grunt config file:</p>

<figure class='code'><figcaption><span>Grunt background shell configuration</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">bgShell</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">weinre</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">cmd</span><span class="o">:</span> <span class="s1">&#39;weinre --httpPort 8080 --boundHost=&#39;</span> <span class="o">+</span> <span class="nx">ipAddress</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">bg</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">rails</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">cmd</span><span class="o">:</span> <span class="s1">&#39;cd ../raisemore_web &amp;&amp; bundle install &amp;&amp; rails s -p 3000 -b &#39;</span> <span class="o">+</span> <span class="nx">ipAddress</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That covers the servers. Now, for the xcode build and ios-simulator, we&rsquo;ll use the standard <a href="https://github.com/sindresorhus/grunt-shell">grunt shell</a> plugin to keep running in sync. To invoke the iOS simulator, we&rsquo;ll use the Node.js package from Phonegap called <a href="https://github.com/phonegap/ios-sim">ios-sim</a></p>

<p>Before we can use ios-sim, we must invoke the npm installer for it, passing the -g flag for it to be globally installed.</p>

<figure class='code'><figcaption><span>Installing ios-sim</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo npm install ios-sim -g
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s configure the grunt shell tasks for xcode build and iphone simulation:</p>

<figure class='code'><figcaption><span>Grunt shell configuration for xcode build and ios-sim</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">shell</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">xcodebuild</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">stdout</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">command</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>          <span class="s1">&#39;cd ./ios&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;xcodebuild -project RaiseMore.xcodeproj -sdk iphonesimulator7.0 -scheme RaiseMore -configuration Debug install DSTROOT=/tmp/RaiseMore&#39;</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">iphonesimulator</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">stdout</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">command</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>          <span class="s1">&#39;ios-sim launch /tmp/RaiseMore/Applications/RaiseMore.app --sdk 5.0&#39;</span>
</span><span class='line'>      <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That covers the configuration. Now we just need to have a grunt task that will handle all the preprocessing, start the servers, and then start the build process, and finally run the simulator with the newly built app.</p>

<p>The preprocessing steps were covered in my previous post <a href="/blog/2013/11/30/automating-phonegap-builds-with-grunt/">here</a> and I&rsquo;ll leave the preprocessing configuration in that post.</p>

<p>All that is left now is to define the grunt tasks, as such:</p>

<figure class='code'><figcaption><span>Grunt task definition</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//Main task for our designer</span>
</span><span class='line'><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;emulator&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;env:dev&#39;</span><span class="p">,</span> <span class="s1">&#39;preprocess:dev&#39;</span><span class="p">,</span> <span class="s1">&#39;bgShell:weinre&#39;</span><span class="p">,</span> <span class="s1">&#39;bgShell:rails&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:xcodebuild&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:iphonesimulator&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Main task I&#39;ll probably use, via &#39;grunt servers --weinre=true --host=192.168.1.100&#39;</span>
</span><span class='line'><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;servers&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bgShell:weinre&#39;</span><span class="p">,</span> <span class="s1">&#39;bgShell:rails&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using the task</h3>

<p>To just boot up the servers, do this:</p>

<figure class='code'><figcaption><span>Invoking the grunt server task</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>grunt servers
</span></code></pre></td></tr></table></div></figure>


<p>If you want the servers and the simulator, do this:</p>

<figure class='code'><figcaption><span>Invoking the grunt emulator task</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>grunt emulator
</span></code></pre></td></tr></table></div></figure>


<p>I know these methods aren&rsquo;t perfect, as there are a few areas I&rsquo;d like to improve on. I&rsquo;d like to have bgShell track the processes to kill them if the task is stopped, or instead to have them ignored if they are already running.</p>

<p>I guess that work will have to be addressed later. Cheers.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Josh Bavari</span></span>

      








  


<time datetime="2013-12-02T19:15:00-07:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/automation/'>automation</a>, <a class='category' href='/blog/categories/eclipse/'>eclipse</a>, <a class='category' href='/blog/categories/gruntjs/'>gruntjs</a>, <a class='category' href='/blog/categories/weinre/'>weinre</a>, <a class='category' href='/blog/categories/xcode/'>xcode</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jbavari.github.io/blog/2013/12/02/automating-underlying-mobile-infrastructure-with-grunt/" data-via="jbavari" data-counturl="http://jbavari.github.io/blog/2013/12/02/automating-underlying-mobile-infrastructure-with-grunt/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/11/30/automating-phonegap-builds-with-grunt/" title="Previous Post: Automating Phonegap Builds with Grunt">&laquo; Automating Phonegap Builds with Grunt</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/12/03/automating-jasmine-tests-with-grunt-karma/" title="Next Post: Automating Jasmine Tests With Grunt Karma">Automating Jasmine Tests With Grunt Karma &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/02/23/the-victim-or-the-victor/">The Victim or the Victor</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/29/3-years-of-elixir-reflections/">3 Years of Elixir: Reflections</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/16/puppet-a-testing-handbook/">Puppet: A Testing Handbook</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/13/test-coverage-reports-in-elixir/">Test Coverage Reports in Elixir</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/29/multicast-service-discovery-in-electron/">Multicast Service Discovery in Electron</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jbavari">@jbavari</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jbavari',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Josh Bavari -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <script src="//static.getclicky.com/js" type="text/javascript"></script>
  <script type="text/javascript">try{ clicky.init(100896582); }catch(e){}</script>
  <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100896582ns.gif" /></p></noscript>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'joshbavari';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jbavari.github.io/blog/2013/12/02/automating-underlying-mobile-infrastructure-with-grunt/';
        var disqus_url = 'http://jbavari.github.io/blog/2013/12/02/automating-underlying-mobile-infrastructure-with-grunt/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
