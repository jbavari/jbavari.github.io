
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Josh Bavari's Thoughts</title>
  <meta name="author" content="Josh Bavari">

  
  <meta name="description" content="I feel that there is a lot of things I can say about the world today. First, there is a lot of bullcrap that we churn through in our minds. You know &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jbavari.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Josh Bavari's Thoughts" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Josh Bavari's Thoughts</a></h1>
  
    <h2>Thoughts on technology and philosophy</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jbavari.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/speaking">Speaking</a></li>
  <li><a href="/knowledge">Knowledge</a></li>
  <li><a href="/about/resume">Resume</a></li>
  <li><a href="/about/cv">C.V.</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/12/23/take-action-now/">Take Action Now</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2019-12-23T20:52:00-07:00" pubdate data-updated="true">Dec 23<span>rd</span>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I feel that there is a lot of things I can say about the world today. First, there is a lot of bullcrap that we churn through in our minds. You know the sort that I&rsquo;m talking about &ndash; the self deception. The thought that I&rsquo;m going places, without taking the action to take those steps to start that path. Those new years resolutions. Those goals that you write down, but do not get action items defined and set up on the calendar. Those same action items you don&rsquo;t check in on from time to time. Things that we tell ourselves that we&rsquo;ll get to tomorrow. We rarely do. We think in terms of intentions &ndash; and judging ourselves retroactively based on those intentions rather than the actions.</p>

<p>Our actions become who we are. This much is true by everyone. Most people carry a picture of themselves in their mind that they think they are. In those that really are that person of action, rarely spend time thinking of what they should be doing. They are currently working towards being what they should be, instead of thinking of it. &ldquo;A good plan, violently executed now, is better than a perfect plan next week.&rdquo; &ndash; George Patton.</p>

<p>They used to call George Patton &ndash; old blood and guts. Here&rsquo;s his thoughts on embracing your part to play, regardless of the role:</p>

<p>&ldquo;All of the real heroes are not storybook combat fighters, either. Every single man in this Army plays a vital role &hellip; . Don’t ever think that your job is unimportant. Every man has a job to do and he must do it. Every man is a vital link in the great chain.&rdquo;</p>

<p>This same mindset exists in today&rsquo;s day and age. We all have a crucial role to play in the world of hate. We must lay steadfast in our power in the world. Strive the be the best at what you do. We all pay our part back to mankind. When we embrace what our purpose is &ndash; and strive to better in that department &ndash; we make the world a better place.</p>

<p>When you find yourself becoming paralyzed by needing a perfect plan, remember: you came here to serve, to take action, to think through a plan, and to execute. Don&rsquo;t get hung up on the plan phase too long or you won&rsquo;t get to play your part. Only your actions echo through time.</p>

<p>Here&rsquo;s a trick to take action sooner &ndash; if you&rsquo;re starting a new project or path, think of a few things that you have done already towards that goal.</p>

<p>For example, when setting a weight loss goal: &ldquo;I want to get down to 185&rdquo;. You could tell yourself, &ldquo;I&rsquo;m at 205, down from 220. I&rsquo;m already down 20%&rdquo;.</p>

<p>Citing some psychology tricks I&rsquo;ve pulled from the book, &ldquo;Switch: How to change things when change is hard&rdquo;. This book tells a story about sales tactics &ndash; one store gives customers a &lsquo;buy 8, get one free card&rsquo;. Another store gives customers &lsquo;buy 10, get one free&rsquo;, but they give the first 2 items starting off the bat. The second store sees an 80% return in customers. The psychology here is, they&rsquo;ve gotten started, the momentum is there.</p>

<p>Remember, physics always wins. Momentum exists in our mind, overcome that by using the gravity of starting conditions to help it along.</p>

<p>Keep a calendar to keep momentum going. Put an &lsquo;X&rsquo; on the date to remind yourself of the building momentum. Once it starts, it will be harder to stop.</p>

<p>Take action now. Get started. That starting momentum can carry you along.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/11/10/continuous-deilvery-book-review/">Continuous Delivery - Book Review</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2019-11-10T11:16:00-07:00" pubdate data-updated="true">Nov 10<span>th</span>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m still diving into the <a href="https://www.amazon.com/Continuous-Delivery-Deployment-Automation-Addison-Wesley/dp/0321601912/ref=sr_1_4?crid=3LLBV00FE8TG3&amp;keywords=continuous+delivery&amp;qid=1576211505&amp;sprefix=continuous+deliv%2Caps%2C192&amp;sr=8-4">Continuous Delivery book</a>. I wanted to sketch out some (very) sparse notes in an attempt to retain the material.</p>

<h1>Chapter 1</h1>

<h2>Common release Anti-patterns</h2>

<ul>
<li>Deploying software manually</li>
<li>Deploying to a production-like environment only after Development is complete</li>
<li>Manual configuration management of production environments</li>
</ul>


<h2>Stages of a deployment pipeline</h2>

<ul>
<li>The commit stage &ndash; compile, unit test, analysis, build installers</li>
<li>Automated acceptance testing</li>
<li>Automated capacity testing</li>
<li>Manual testing &ndash; showcases, exploratory, testing</li>
<li>Release</li>
</ul>


<h3>Deploying to a production-like environment only after Development is complete</h3>

<h4>Problems</h4>

<ul>
<li>Ensure teams are working towards production type releases on a regular cadence, not in extended periods of time.</li>
<li>Manual configurations cause issues &ndash; work towards trying to automate those portions.</li>
<li>Scripts to do the deployments are better than manual steps written up. Documentation goes out of date, requires extra effort to keep alignment.</li>
<li>Need tighter collaboration between development and deployment teams.</li>
<li>Deploying to staging faster (where environments are closer to production) helps uncover issues, bind the dev/ops teams, and drives fixes to deployments faster.</li>
<li>The bigger diff between deployment and production environments</li>
</ul>


<h4>Solutions</h4>

<ul>
<li>Rehearse deployments to a staging or production-like environment several times before actually going to production.</li>
<li>Make sure everyone who is doing the deployments are working together on the deployments from the start of the project.</li>
<li>Make the cornerstone of deployment a means of testing both software and deployments throughout the process.</li>
</ul>


<h3>Manual configuration management of production environments</h3>

<h4>Signs of this anti-pattern</h4>

<ul>
<li>Having deployed successfully to many times to staging, the deployment to production fails.</li>
<li>The operations teams take longer to prepare an environment for a release.</li>
<li>You cannot step back to a prior configuration of your system.</li>
<li>Servers in the operating environments, unintentionally, have different versions of operating systems, third-party infrastructure, libraries, or patch levels.</li>
<li>Configuration of the system is carried out by modifying the configuration directly on production systems.</li>
</ul>


<h4>Solutions</h4>

<ul>
<li>All aspects of testing, staging, and production specifically the configuration of any third-party elements of the system should be applied from version control through an automated process.</li>
<li>The only way to make changes to production should be done through an automated process.</li>
<li>Make it possible to see at a glance what the currently released version of every piece of software is.</li>
<li>Make releases boring &ndash; to the point where they are cheap, low-risk, frequent, rapid, and predictable.</li>
</ul>


<h2>How to achieve these solutions?</h2>

<ul>
<li>Automate &ndash; make it repeatable without failure.</li>
<li>Frequent &ndash; make deltas between releases smaller to reduce risk and get immediate feedback.</li>
</ul>


<p>Three criteria to make feedback to be useful:
* Any change, whatever kind, needs to trigger the feedback process.
* The feedback must be delivered as soon as possible.
* The delivery team must receive feedback and then act on it.</p>

<p>How to get this feedback?</p>

<p>Working software decomposed into 4 components:</p>

<ul>
<li>Executable code</li>
<li>Configuration</li>
<li>Host environment</li>
<li>Data</li>
</ul>


<p>You should aim to have the executable code to be reused everywhere it is needed and never rebuilt.</p>

<p>Any change to an applications configuration, in whichever environment, should be tested with a representative range of the example systems.</p>

<p>If the environments are to changed, the whole system should be tested with the changes to the environment.</p>

<p>Finally, if the structure of the data changes, the change must also be tested.</p>

<p>The authors mention a few simple feedback checks:</p>

<ul>
<li>The software should fulfill certain requirements such as test coverage and other technology-specific metrics.</li>
<li>The software&rsquo;s functional acceptance tests must pass. This is a test on the business acceptance criteria.</li>
<li>The software&rsquo;s nonfunctional tests must pass &ndash; in regards to capacity, availability, security, and so on to meet it&rsquo;s users needs.</li>
</ul>


<p>Another key point the authors bring up that implementing a deployment pipeline is resource-intensive, especially once you have a comprehensive automated test suite. One of the key objectives is to optimize for human resource usage: we want to free the people to do the interesting work and leave repetition to machines.</p>

<p>The authors suggest to aim for 75% or so of the codebase.</p>

<h3>Breaking down the steps of the pipeline</h3>

<p>If tests fail in the early stages of the pipeline, they should not advance. We should aim to build a high confidence in the software in the first set of tests.</p>

<hr />

<p>Random notes:</p>

<p>CH1 &ndash; author recommends to get cross-functional groups all along the process. Also aim to have retrospections with the entire crew of developers, infra/operations, and testing</p>

<p>Being able to react to feedback also means broadcasting information. Using big, visible dashboards and other notification mechanisms. Also aim to make one is present in each team room.</p>

<p>Feedback is no good unless it is acted on.</p>

<p>Authors make a point here that by giving more of the pull/self-service model, you can increase velocity:
* Testers can select older versions of software to test with
* Support staff can deploy a released version into an environment to reproduce a defect.
* Operations staff can select a known good build to deploy into production as part of disaster recovery
* Releases can happen at a push of a button.</p>

<p>Note here applying to work:
* In each PR, it should address:
* Change in code
* Change in configuration (if any)
* Change in host environment (if any)
* Change in structures of data</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/10/08/clean-architecture-book-review/">Clean Architecture - Book Review</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2019-10-08T21:48:00-06:00" pubdate data-updated="true">Oct 8<span>th</span>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve recently read and held a nerd book club at work regarding Clean Architecture. Overall, I found this read easy to grok and entertain a few new ideas about software development. Uncle Bob also had a few things <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">on his blog post</a> about this topic.</p>

<p>If I could wrap up one picture that encompases the book:</p>

<p><img src="https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg" alt="This image" /></p>

<p>I&rsquo;ve also recently read parts of Domain Driven Design that introduce this same concept. I think Uncle Bob does a great job of sharing some great examples of the book of how architecture is an art, one that can morph with the needs of the project at hand, and is subject to trade-offs through the entire lifecycle of software. I love that the book starts off expressing the idea that thinking of delivery early on is a wise decision to incorporate into the architecture design.</p>

<p>Some other great points I found worthy of mention:</p>

<ul>
<li>How to think of the division of software with regards to firmware and hardware abstraction layers.</li>
<li>Most things are details &ndash; the framework, the database, the GUI, firmware &ndash; keep it separated from the internal domain layers of your business logic however possible.</li>
<li>SOLID Principles are important &ndash; also integrate into architecture design.</li>
<li>Architecture design with traditional monolith, service oriented, and micro-service anti-pattern warnings.</li>
<li>The idea that there is no silver bullet &ndash; <a href="https://twitter.com/codepitbull/status/784691906005635072">A good developer is like a werewolf: afraid of silver bullets</a></li>
</ul>


<p>This book club also gave the team some time to reflect and dive into the design of our current projects. Overall, this was a great book for a team to cover and come up with some action items to drive better software going forward.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/09/12/on-the-clock/">On the Clock</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2019-09-12T21:55:00-06:00" pubdate data-updated="true">Sep 12<span>th</span>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was at the grocery the other day and I heard one worker asked another if they were on the clock. For some reason, it spurred some thoughts of my own.</p>

<p>I first was caught off guard by this seemingly small comment, because in my own head I was playing back an event from my current day at the work. What does being on the clock mean for me? For hourly workers, it&rsquo;s clear. The thought I was playing with here was the idea that most people are usually on the clock most of the time.</p>

<p>Does our work even span futher into deeper spots of our minds? When you&rsquo;re not at work, you may think of work, as I was, and you might also have work going on in your subconscious. Not necessarily stressful type events, it could even be positive things that you enjoy about your work.</p>

<p>There are many books on the procrastination and avoidance of work. I don&rsquo;t aim to dive into that. I wanted to approach the idea from a stoic approach. Does work &lsquo;work&rsquo; us by making think about it when we&rsquo;re not doing it? If the mind were not consumed with work, what would we be doing otherwise?</p>

<p>In Meditations, Marcus states:</p>

<blockquote><p>So you were born to feel “nice”? Instead of doing things and experiencing them? Don’t you see the plants, the birds, the ants and spiders and bees going about their individual tasks, putting the world in order, as best they can? And you’re not willing to do your job as a human being? Why aren’t you running to do what your nature demands?</p></blockquote>

<p>That has sat deep with me lately, and I couldn&rsquo;t stop from myself from exploring this idea of work being a dread. For some, their work is more thrilling than the warm bed. That is not to say, they do not still enjoy that. I am sure that is a natural instinct. What is the cause for that override in one&rsquo;s mind?</p>

<p>It must drive further in, from the purpose center of the brain and the being. When someone can turn their work into a form of play, and others cannot, we must ask what that driving force is. By understanding it, we may understand ourselves, and empower others to help themselves. &ldquo;What is good for the hive is good for the bee&rdquo;.</p>

<p>Is this mindset really everything? Certainly it is not constant and certainly ebbs and flows, as is nature. As Epictetus states, &ldquo;there is nothing good or evil save in the will&rdquo;. Is work a negative thing while pleasure is good? The ying in the yang for happiness is sadness, so then the ying in work must have the yang in relaxation.</p>

<p>In todays hyper speed of intelligence work, do we ever get off of the clock? Is it possible to be off the clock, if one had some way to measure?</p>

<p>Or rather, is the clock not binary, but again an ebb and flow of time throughout ones life? In modern American society, most people work 40-60 hour work weeks. With life being half of your life, it aligns with one&rsquo;s own self interest to focus on the balance as best as possible.</p>

<p>As I move forward in my working career, I aim to see it as my mission, my purpose, for what else would I be doing? I&rsquo;m fortunate to be able to work on challenging topics, evolving problems, and being surrounded by others on their own same like-missions. I aim to take the mindset of being fortuate to do these things and experiencing them.</p>

<p>Embrace the clock. Find the flow.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/02/23/the-victim-or-the-victor/">The Victim or the Victor</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2019-02-23T07:14:00-07:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I was a younger boy, my grandma would tell me stories of my grandfather going to war. Like most men during world war 2, he did not want to go to leave his new bride and head to where death is ever looming. One thing I remember her saying to me as a life lesson is that you&rsquo;re given a choice in life that most always boils down to your attitude. She said, &ldquo;just like your grandpa, you can chose to be a victim, or go get the courage to become a victor. The choice is always yours.&rdquo;</p>

<p>What does this mean? This means, when given any situation, your belief about the situation will in turn guide your thoughts and actions. This belief is so strong that even the way you think and address the situation happens whether or not your are conscious about it. The obvious choice would to be to see yourself as given a challenge that you must rise to and become a victor over.</p>

<p>The opposite is true &ndash; you could be given a challenge and say, &lsquo;why me&rsquo;. From this victim midset, you have now set yourself up for failure from the start. You&rsquo;ve seen the challenge become the burden.</p>

<p>That thought has always been on my mind throughout the years, but I have to admit I haven&rsquo;t always been as couragous as I could have been. You always assume when the time comes, you&rsquo;ll be ready. The fact is, it comes and hits you in the face right when you&rsquo;re planning for it. &ldquo;Everyone has a plan until you&rsquo;re punched in the face&rdquo;. The point is, the mindset of preparation is the key to success. My study of <a href="http://thedailystoic.com">stoicism</a> has lead me lately to living as if it has already happened, being unphased by things we should expect happen, and turning my &lsquo;have to&rsquo;s into &#8216;get to&rsquo;s.</p>

<p>How do you break this cycle? You start by examining your internal thoughts first. Now that you are conscious about your thoughts, you can then analyze how to course-correct. Until then, you might be in the default victim midset and not even know it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/01/29/3-years-of-elixir-reflections/">3 Years of Elixir: Reflections</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2019-01-29T07:30:00-07:00" pubdate data-updated="true">Jan 29<span>th</span>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Back in 2015, I had just started at <a href="http://canvas.technology">CANVAS Technology</a> and my task was clear: to create a web application that can service many operations concurrently from users, robots, and other integration services. Prior to this new venture, I had spent my last few years doing Ruby on Rails, Node.js JavaScript, mobile applications (cordova, minimal Objective-C, Java/Android). Only a few months before joining CANVAS had I just started playing with Elixir and Phoenix. I was so excited and relieved to find something that was geared exactly for what we were embarking on.</p>

<p>What I want to outline in this post is the lessons I&rsquo;ve learned using Elixir these last 3+ years and help others learn quickly.</p>

<h2>Upgrade sooner than later</h2>

<p>Discuss pains of upgrading Elixir 1.3 &ndash;> 1.6, Ecto 1.0 &ndash;> 2.0, Phoenix 0.9 &ndash;> 1.3. It definitely hasn&rsquo;t been easy to update, this is mitigated by staying abreast of Elixir / phoenix changes and trying to implement early.</p>

<h2>GenServers are your friend &ndash; but use them only if you must</h2>

<p>Abstract away the API and the Server &ndash; link to post by <a href="https://pragdave.me/blog/2017/07/13/decoupling-interface-and-implementation-in-elixir.html">Dave Thomas explaining splitting the APIs, Servers, and Implementations in Elixir</a>.</p>

<h2>Testing pains with GenServers and Ecto&rsquo;s concurrency model</h2>

<p>Make sure to restart genservers / supervisors. Having a connection time out be longer for longer running genservers that aren&rsquo;t started every setup fixture.</p>

<h2>Using docker for team / testing scenarios</h2>

<p>Docker-compose for stack, testing with diff vars. Preload any databases by putting them in the postgres container root in <code>/tmp</code>.</p>

<h2>Testing browsers with Hound / ChromeDriver</h2>

<p>Use Hound and chromedriver.</p>

<h2>Do not code everything to the <code>Repo</code> itself</h2>

<p>It&rsquo;s not as easy to cut off your database addiction. Having an intermediate context API that cache is a good first step.</p>

<h2>PubSub is your friend, use structs to pass messages</h2>

<p>When using cast/gproc, pass the Structs, don&rsquo;t use tuples. Resist the simple solutiuons. Pass structs defined.</p>

<h2>Learn ETS</h2>

<p>Don&rsquo;t use a cache when the Erlang VM has one built in.</p>

<h2>Use behaviours</h2>

<p>Take a look how <a href="https://github.com/aaronrenner/crowdfundr">crowdfundr</a> app. Code to interfaces, not the implementations. Use the <code>impl</code> approach.</p>

<h2>Nginx as a front-end for SSL termination</h2>

<p>Links/discussion to the post, security wise, leave Nginx to handle the vulns and your app to handle the impl.</p>

<h2>Releases with Distillery</h2>

<p>Ship those tarballs, let it fly. Easier/safer than shiping your code. Should probably post about the replacing of ENV vars. Use a Config module for system set env variables instead of them getting baked into your <code>sys.config</code> file.</p>

<h2>Clustering &ndash; using epmd / GenServers for node communication message passing</h2>

<p>Link to swarm and libcluster &ndash; knowing that clustering comes out of the box with Erlang/Elixir.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/04/16/puppet-a-testing-handbook/">Puppet: A Testing Handbook</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2017-04-16T13:09:00-06:00" pubdate data-updated="true">Apr 16<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>Explain why the post &ndash; job required, growing pains, need for stability and health of the repo</li>
<li>Why to test</li>
<li>What to test</li>
<li>How to test
<strong> Lint &ndash; Rake file
</strong> Parser &ndash; rake file with globbing to run easier
<strong> Rspec &ndash; spec type tests to run on puppet code (syntax mainly)
</strong> Beaker &ndash; run tests on provisioned VM to ensure correct</li>
</ul>


<p>Cover:</p>

<p>puppet-lint
puppet parser validate &lt;manifest.pp>
puppet-rspec &ndash; A gem that runs rspec unit tests on a module (Based on compiled catalog)
Beaker</p>

<hr />

<p>Part of my role at work is managing a fleet of robots, servers, and other
infrastructure responsible for running our business. Due to the nature of our
business, we run within customer warehouses.</p>

<p>Being a one man operation, one of my main concerns is keeping all the systems
stable and proper working conditions. I am not the only developer touching our
puppet code, but I&rsquo;m the one responsible for the system(s).</p>

<p>As I embarked on the journey to add reliability to our infrastructure, something
very clear came up: there&rsquo;s a lot of information about testing puppet, but most
of it is fractured, out of date, or hard to understand. <a href="https://www.slideshare.net/PuppetLabs/puppetconf-2016-the-future-of-testing-puppet-code-gareth-rushgrove-puppet?qid=eee7d5c2-f52e-4ceb-8000-42e4fc174721&amp;v=&amp;b=&amp;from_search=2">See this slideshow from 2016 about the state of testing puppet</a>.</p>

<p>I&rsquo;m writing this post up to act as a handbook of sorts for testing puppet, as
well as a &lsquo;repository&rsquo; for testing puppet.</p>

<h1>Testing resources</h1>

<ul>
<li><a href="http://puppet-lint.com/">Puppet-lint</a> &ndash; Useful for linting your puppet code</li>
<li><a href="http://rspec-puppet.com/">Rspec Puppet</a> &ndash; Rspec tests for puppet code</li>
<li><a href="https://docs.puppet.com/puppet/4.10/tests_smoke.html">Puppet: module smoke testing</a></li>
<li><a href="http://www.example42.com/tutorials/PuppetTutorial/#slide-80">Slideshow about all things puppet</a></li>
<li><a href="https://www.safaribooksonline.com/library/view/extending-puppet-/9781785885686/">Extending Puppet &ndash; Second Edition</a></li>
<li><a href="https://github.com/puppetlabs/beaker/">Beaker</a></li>
<li><a href="http://www.xkyle.com/getting-started-puppet-acceptance-tests-with-beaker/">Getting Started Puppet Acceptance Tests With Beaker</a></li>
<li><a href="https://github.com/puppetlabs/puppetlabs-mysql/tree/master/spec">Great example of testing &ndash; Puppet MySQL module</a></li>
<li><a href="https://github.com/puppetlabs/puppetlabs_spec_helper">Puppetlabs Spec Helper</a></li>
<li><a href="https://www.puppetcookbook.com/posts/simple-syntax-check-manifests.html">Puppet Cookbook &ndash; Simple Syntax Check</a></li>
<li><a href="http://www.cakesolutions.net/teamblogs/testing-puppet">Testing Puppet</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/03/13/test-coverage-reports-in-elixir/">Test Coverage Reports in Elixir</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2017-03-13T18:38:00-06:00" pubdate data-updated="true">Mar 13<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately I&rsquo;ve been learning a ton more about Elixir and really working towards refactoring and hardening the system.</p>

<p>On my current project, I&rsquo;ve got about 200 tests that exercise various parts of the system. Lately though, I&rsquo;ve been trying to analyze which parts of the system aren&rsquo;t being covered, and of course, theres tools to help with that.</p>

<p>The two I looked at were <a href="https://github.com/parroty/excoveralls">Coveralls</a> and <a href="https://github.com/alfert/coverex">Coverex</a>. I&rsquo;m going to be using <code>coverex</code> in this post.</p>

<p>Getting started is a breeze, check the readme for that. I&rsquo;ll cover it briefly for a bit here, my modifying our <code>mix.exs</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'>  <span class="c1"># in `def project`, we add test_coverage</span>
</span><span class='line'>  <span class="ss">test_coverage:</span> <span class="p">[</span>
</span><span class='line'>    <span class="ss">tool:</span> <span class="no">Coverex</span><span class="o">.</span><span class="no">Task</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># in deps, add the depedency for only test environment</span>
</span><span class='line'>  <span class="p">{</span><span class="ss">:coverex</span><span class="p">,</span> <span class="s2">&quot;~&gt; 1.4.10&quot;</span><span class="p">,</span> <span class="ss">only:</span> <span class="ss">:test</span><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>After setup, running <code>mix test --cover</code> generates some reports in your projects <code>./cover</code> folder &ndash; with <code>functions.html</code> and <code>modules.html</code>. These give you your standard coverage reports with lines covered / ratio covered.</p>

<p>For my project, I had quite a bit of generated files using <a href="https://github.com/bitwalker/exprotobuf">exprotobuf</a>. The coverage report was getting butchered from not using these many files in my tests.</p>

<p>According to the docs, we can add a keyword for <code>ignore_modules</code> in the keyword list <code>test_coverage</code> and the coverage reports will ignore those modules.</p>

<p>However, for my generated list of modules, I had quite the growing list to ignore and it quickly became unwieldy to put that list of modules in my <code>mix.exs</code> file.</p>

<p>Since we can&rsquo;t access other modules from our mix file, I had a quick solution. I created a <code>.coverignore</code> file in the project directory, lumped in all the modules I wanted to ignore (from the <code>modules.html</code> generated file) and put them all in the <code>.coverignore</code> file.</p>

<p>I ensured all the modules I wanted to ignore were all newline delimited (<code>\n</code>).</p>

<p>From there, I modified my <code>mix.exs</code> file as such:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'>  <span class="c1"># Near the top</span>
</span><span class='line'>  <span class="nv">@ignore_modules</span> <span class="no">File</span><span class="o">.</span><span class="n">read!</span><span class="p">(</span><span class="s2">&quot;./.coverignore&quot;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="err">&amp;</span><span class="p">(</span><span class="no">String</span><span class="o">.</span><span class="n">to_atom</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># in def project</span>
</span><span class='line'>  <span class="ss">test_coverage:</span> <span class="p">[</span>
</span><span class='line'>    <span class="ss">tool:</span> <span class="no">Coverex</span><span class="o">.</span><span class="no">Task</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">ignore_modules:</span> <span class="nv">@ignore_modules</span>
</span><span class='line'>  <span class="p">],</span>
</span></code></pre></td></tr></table></div></figure>


<p>Boom, that does it! Now we&rsquo;ve got a manageable list of modules to ignore in a separate file so we can keep our mix file clean.</p>

<p>All in all, <code>coverex</code> is a great module, and I would suggest using it if you do not want to ship data to coveralls.</p>

<p>Hope this helps, happy coding. Cheers!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/12/29/multicast-service-discovery-in-electron/">Multicast Service Discovery in Electron</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2016-12-29T14:01:00-07:00" pubdate data-updated="true">Dec 29<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve been playing around with mDNS lately for broadcasting some services for applications to auto-connect with.</p>

<p>The first experiment I had was setting up a server that broadcasts a TCP endpoint for an Electron application to discover and connect for the application data.</p>

<p>This was so easily done that I challenged myself to see how fast I can whip out a blog post.</p>

<p>First, get an Ubuntu server up (I used a Vagrant VM).</p>

<p>Run the commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install avahi-utils</span></code></pre></td></tr></table></div></figure>


<p>From here, the service for avahi (mdns) should be auto-started. Edit the configuration to enable broadcasting:</p>

<p><code>vim /etc/avahi/avahi-daemon.conf</code> – here’s a config that’s minimally broadcasting only the IPv4 address:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[server]
</span><span class='line'>host-name=webserver
</span><span class='line'>domain-name=local
</span><span class='line'>use-ipv4=yes
</span><span class='line'>use-ipv6=no
</span><span class='line'>allow-interfaces=eth1
</span><span class='line'>deny-interfaces=eth0
</span><span class='line'>ratelimit-interval-usec=1000000
</span><span class='line'>ratelimit-burst=1000
</span><span class='line'>
</span><span class='line'>[wide-area]
</span><span class='line'>enable-wide-area=yes
</span><span class='line'>
</span><span class='line'>[publish]
</span><span class='line'>publish-addresses=yes
</span><span class='line'>publish-hinfo=yes
</span><span class='line'>publish-workstation=no
</span><span class='line'>publish-domain=yes</span></code></pre></td></tr></table></div></figure>


<p>Now, create a service configuration: <code>vim /etc/avahi/services/mywebserver.service</code>, with this contents:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;service-group&gt;
</span><span class='line'>  &lt;name&gt;Webserver&lt;/name&gt;
</span><span class='line'>  &lt;service&gt;
</span><span class='line'>    &lt;type&gt;_http._tcp&lt;/type&gt;
</span><span class='line'>    &lt;port&gt;80&lt;/port&gt;
</span><span class='line'>  &lt;/service&gt;
</span><span class='line'>&lt;/service-group&gt;</span></code></pre></td></tr></table></div></figure>


<p>Simple as that. Just restart the avahi-daemon – <code>sudo service avahi-daemon restart</code>.</p>

<p>This should now have your server broadcasting that it has a webserver running at port 80, named <code>Webserver</code>.</p>

<p>To check the service is broadcasting, run <code>avahi-browse _http._tcp -tr</code> – this should show your server as servername.local, with <code>Webserver</code>, pointing to its IP and port.</p>

<p>Example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+   eth1 IPv4 webserver                              Web Site             local
</span><span class='line'>=   eth1 IPv4 webserver                              Web Site             local
</span><span class='line'>   hostname = [webserver.local]
</span><span class='line'>   address = [192.168.0.101]
</span><span class='line'>   port = [80]
</span><span class='line'>   txt = []</span></code></pre></td></tr></table></div></figure>


<p>Now for the electron portion, in your application, install the node mdns module: <code>npm install --save mdns</code>.</p>

<p>This will add the node module to your project, but since it has native compilation steps, you must build it with <code>electron-rebuild</code>. Do this: <code>npm install --save-dev electron-rebuild</code>.</p>

<p>Then run: <code>./node_modules/.bin/electron-rebuild</code> – this will rebuild the mdns module for your electron node version correctly.</p>

<p>To do the DNS lookups, simply run the steps from the node mdns <code>README</code>. Set the discovery type to <code>http</code> and it will find your service. From there, you can grab the address and then get the data from the web server (or html page redirection) as you so wish!</p>

<p>Happy coding!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/11/using-erlang-observer-on-a-remote-elixir-server/">Using Erlang Observer on a Remote Elixir Server</a></h1>
    
    
      <p class="meta">
        <span class="reading-time">less than a 1 minute read</span>
        








  


<time datetime="2016-03-11T14:01:00-07:00" pubdate data-updated="true">Mar 11<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve been using Elixir a ton at work and in some fun side projects and I’m absolutely in love with it.</p>

<p>One tool I especially love is the Erlang Observer tool, that shows you IO, memory, and CPU usage used by your app and the Erlang VM.</p>

<p>Once I got some apps deployed, I wanted to observe them remotely. I found a few <a href="https://groups.google.com/forum/#!topic/elixir-lang-talk/312PlJLSgLw">google forum</a> posts and the <a href="http://elixir-lang.org/docs/stable/iex/IEx.html">IEx docs</a>, but I wanted to wrap up this knowledge for when I need it in the future.</p>

<p>I’m going to monitor a Phoenix app in this quick blog post.</p>

<p>First, fire up your Phoenix server on say, a VPS, giving it a node name:</p>

<p><code>iex --name server@64.16.134.61 --cookie jbavari -S mix phoenix.server</code></p>

<p>Then on your remote viewing machine, say your Mac, run the following:</p>

<p><code>iex --name josh@192.168.1.1 --cookie jbavari</code></p>

<p>Now we’re set up to do some remote observations!</p>

<p>Fire up <code>:observer.start</code> on your local machine, which should open up the Erlang observer.</p>

<p>Now from the menu, select ‘Nodes’, then you should see your node there. If not, click the connect to node button, type in your <code>server@64.16.134.61</code> node address and you should be able to view your node via the observer!</p>

<p>Enjoy!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/12/23/take-action-now/">Take Action Now</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/11/10/continuous-deilvery-book-review/">Continuous Delivery - Book Review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/08/clean-architecture-book-review/">Clean Architecture - Book Review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/09/12/on-the-clock/">On the Clock</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/23/the-victim-or-the-victor/">The Victim or the Victor</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jbavari">@jbavari</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jbavari',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Josh Bavari -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <script src="//static.getclicky.com/js" type="text/javascript"></script>
  <script type="text/javascript">try{ clicky.init(100896582); }catch(e){}</script>
  <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100896582ns.gif" /></p></noscript>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'joshbavari';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
